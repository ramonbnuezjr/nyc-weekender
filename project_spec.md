# NYC Chatbot v0 — Project Spec

## One-liner
A clean, Google-like chat UI that can answer NYC-local questions (starting with: "What's going on in Central Park this weekend?") and returns a concise answer plus weather context.

## v0 Scope (tight)
- **APIs**: Google Gemini (LLM), OpenWeatherMap (weather).
- **Question types supported** (initial):
  1) "What's the weather in Central Park this weekend?"
  2) "What should I plan for Central Park this weekend?" → weather-aware suggestions generated by Gemini.
- **Out of scope for v0**: Live event lookups. (Add in v0.1 with NYC Parks Events feed via NYC Open Data/Socrata.)
- **UI**: single search box and a compact response card, keyboard-first.

## v0.1 (very small follow-up)
- Add **NYC Parks Events** (BigApps JSON feed) and/or **NYC Open Data** SODA endpoint to answer "what's going on in Central Park this weekend?" with real events.
- Keep same UI. Add a "Sources" line.

## KPIs (week 1)
- p50 latency ≤ **2.5s**, p95 ≤ **5s** for a typical query.
- ≥ **80%** "useful" thumbs‑up from 10+ test sessions.
- Zero API-key leaks; error rate < **1%** of requests.

## Architecture (v0)
```
[Next.js UI] —> [Edge/Serverless API route] —> [Gemini API]
                                  └——> [OpenWeatherMap /data/2.5/forecast]
```
- Gemini: intent parse + response synthesis (JSON mode for tool outputs).
- Weather: fetched server-side; results injected into Gemini prompt as structured context.

## Prompts (v0)
- **System**: "You are NYC Chat. Be concise. Use JSON tool outputs when provided. Never hallucinate events; if events are unavailable, say so and offer a short plan based on weather."
- **Tool-call schema** (pseudo):
```json
{"tool":"weather.get","args":{"lat":40.7812,"lon":-73.9665,"days":3}}
```

## Acceptance Tests (v0)
- **AT-1**: Input: "What's going on in Central Park this weekend?"  
  Output: States events are coming in v0.1 + gives a 3‑bullet weather-aware suggestion. No made‑up events.
- **AT-2**: Input: "Weather in Central Park this weekend"  
  Output: Returns min/max temps and precipitation probability for Sat/Sun with human summary.
- **AT-3**: Cold start to first byte ≤ 1.5s on broadband; total ≤ 5s (p95).

## Non‑functional
- Observability: basic logging per request (duration, model, cache hits, anonymized IP/UA).
- Rate limiting: 30 req/min/IP in development.
- Privacy: no PII storage; no analytics beyond aggregate counters.

## Data & APIs
- **Gemini**: use latest suitable "Pro/Flash" chat model; enable JSON output for tool calls.
- **Weather**: OpenWeatherMap `/data/2.5/forecast` with `lat,lon,appid,units=imperial,cnt=40`.
- **Time semantics**: "weekend" = next Sat/Sun in America/New_York.
- **Coordinates**: Central Park default `(40.7812, -73.9665)`.

## Env & Config
```
GEMINI_API_KEY=...
OPENWEATHER_API_KEY=...
WEATHER_PROVIDER=openweather
OPENWEATHER_BASE=https://api.openweathermap.org/data/2.5
NYC_TIMEZONE=America/New_York
DEFAULT_LAT=40.7812
DEFAULT_LON=-73.9665
MODEL_ID=gemini-2.0-flash
```

## Directory Sketch
```
/app
  /api
    weather.ts    # server-only fetcher
    chat.ts       # orchestrates Gemini + weather
  /ui
    Search.tsx
    Result.tsx
  /lib
    time.ts
    prompts.ts
/improvements.md
/project_spec.md
/activity_log.md
```

## Risks → Mitigations
- **Hallucinated events** → hard rule: no events in v0; add real feed in v0.1.
- **Latency spikes** → cache weather by (lat, weekend); stream Gemini tokens.
- **Scope creep** → ship v0 in 48h, v0.1 right after.

## Milestones
- **Day 1**: scaffold Next.js, env plumbing, weather fetcher, prompt, AT‑2 green.
- **Day 2**: AT‑1 messaging, logging, simple styles, deploy preview. Then v0.1 events.

## Implementation Status ✅
- **Next.js Project**: ✅ Scaffolded with TypeScript + Tailwind
- **Environment Setup**: ✅ Configuration files and API key handling
- **Weather API**: ✅ OpenWeatherMap integration with weekend date logic (upgraded from Open-Meteo)
- **Chat API**: ✅ Gemini AI orchestration with weather context
- **UI Components**: ✅ Google-style dark mode interface with modern search bar
- **Error Handling**: ✅ Loading states and error messages
- **Build System**: ✅ Route segment configs preventing build-time execution
- **Documentation**: ✅ README and setup instructions
- **UI Theme**: ✅ Google dark mode transformation with AI Mode button
- **Weather Provider**: ✅ Upgraded to OpenWeatherMap for better accuracy

## Deployment Notes
- Project builds successfully with `npm run build`
- Development server runs with `npm run dev`
- Ready for production deployment (Vercel, Netlify, etc.)
- Environment variables must be configured in production
- API routes are properly configured for serverless deployment
- OpenWeatherMap API key required for weather functionality
